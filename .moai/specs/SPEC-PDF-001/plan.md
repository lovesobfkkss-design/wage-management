# SPEC-PDF-001 구현 계획

## 1. 구현 개요

| 항목 | 내용 |
|------|------|
| SPEC ID | SPEC-PDF-001 |
| 기능명 | 급여 명세서 PDF 출력 |
| 예상 작업 시간 | 3-4시간 |
| 복잡도 | 중간 |

---

## 2. 파일 변경 계획

### 2.1 신규 파일

| 파일 | 목적 |
|------|------|
| `js/pdf-export.js` | PDF 생성 함수 모듈 |

### 2.2 수정 파일

| 파일 | 변경 내용 |
|------|----------|
| `index.html` | jsPDF CDN 스크립트 추가 |
| `js/app.js` | 급여정산 UI에 PDF 버튼 추가 |

---

## 3. 단계별 구현 계획

### Phase 1: 라이브러리 설정

**작업 내용:**
1. `index.html`에 jsPDF CDN 추가
   ```html
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   ```
2. 스크립트 로드 순서 확인 (utils.js 이후, app.js 이전)

**완료 기준:**
- 브라우저 콘솔에서 `jspdf` 객체 접근 가능

---

### Phase 2: PDF 생성 모듈 개발

**작업 내용:**
1. `js/pdf-export.js` 파일 생성
2. `generateStaffPayrollPDF(staffId, monthKey)` 함수 구현
3. `generateCommissionPDF(instructorId, monthKey)` 함수 구현

**시급제 직원 PDF 구조:**
```
┌─────────────────────────────────────┐
│        강한영어수학학원              │
│         급여 명세서                  │
├─────────────────────────────────────┤
│ 발급일: YYYY년 MM월 DD일             │
│ 정산월: YYYY년 MM월                  │
├─────────────────────────────────────┤
│ [직원 정보]                          │
│ 이름: OOO                           │
│ 직급: 조교/파트강사                  │
├─────────────────────────────────────┤
│ [근무 내역]                          │
│ 총 근무시간: XX.XX 시간              │
│ 시급: XX,XXX 원                      │
│ 세전급여: XXX,XXX 원                 │
├─────────────────────────────────────┤
│ [공제 내역]                          │
│ 공제 유형: 고용보험/사업소득세        │
│ 공제율: X.X%                         │
│ 공제액: XX,XXX 원                    │
├─────────────────────────────────────┤
│ [정산 요약]                          │
│ 세전급여:      XXX,XXX 원            │
│ 공제액:         XX,XXX 원            │
│ ────────────────────────            │
│ 실지급액:      XXX,XXX 원            │
└─────────────────────────────────────┘
```

**비율제 강사 PDF 구조:**
```
┌─────────────────────────────────────┐
│        강한영어수학학원              │
│     비율제 강사 정산 명세서          │
├─────────────────────────────────────┤
│ 발급일: YYYY년 MM월 DD일             │
│ 정산월: YYYY년 MM월                  │
├─────────────────────────────────────┤
│ [강사 정보]                          │
│ 이름: OOO                           │
│ 정산비율: XX%                        │
│ 담당학생: XX명                       │
├─────────────────────────────────────┤
│ [정산 기준]                          │
│ 총 수강료: X,XXX,XXX 원              │
│ 카드수수료(1%): XX,XXX 원            │
│ 수수료공제 후: X,XXX,XXX 원          │
│ 강사 정산액(XX%): XXX,XXX 원         │
├─────────────────────────────────────┤
│ [공제 내역]                          │
│ 사업소득세(3.3%): XX,XXX 원          │
├─────────────────────────────────────┤
│ [최종 정산]                          │
│ 세전정산액:    XXX,XXX 원            │
│ 공제액:        XX,XXX 원             │
│ ────────────────────────            │
│ 실지급액:      XXX,XXX 원            │
└─────────────────────────────────────┘
```

**완료 기준:**
- 콘솔에서 함수 호출 시 PDF 다운로드 성공

---

### Phase 3: UI 통합

**작업 내용:**
1. `js/app.js`의 `renderPayroll()` 함수 수정
2. 시급제 직원 행에 "명세서" 버튼 추가
3. 비율제 강사 행에 "명세서" 버튼 추가

**버튼 HTML:**
```html
<button class="btn btn-sm" onclick="generateStaffPayrollPDF(${staffId}, '${monthKey}')">
  명세서
</button>
```

**완료 기준:**
- 급여정산 탭에서 각 직원/강사 옆에 버튼 표시
- 버튼 클릭 시 PDF 다운로드

---

### Phase 4: 테스트 및 검증

**테스트 항목:**
1. 시급제 직원 PDF 생성 테스트
2. 비율제 강사 PDF 생성 테스트
3. 한글 표시 확인
4. 금액 포맷 확인 (천단위 콤마)
5. 파일명 확인
6. 크로스 브라우저 테스트 (Chrome, Edge)

**완료 기준:**
- 모든 테스트 항목 통과

---

## 4. 의존성

### 4.1 기존 함수 활용
- `getStaffById(id)`: 직원 정보 조회
- `getStaffWorkLogs(staffId, monthKey)`: 근무 기록 조회
- `calculateWage(staff, totalHours)`: 급여 계산
- `calculateDeduction(staff, grossPay, settings)`: 공제 계산
- `getCommissionInstructorById(id)`: 강사 정보 조회
- `getCommissionStudents(instructorId, monthKey)`: 학생 목록 조회
- `calculateCommission(instructor, students, settings)`: 비율제 정산 계산
- `formatKRW(amount)`: 금액 포맷팅

### 4.2 외부 라이브러리
- jsPDF 2.5.1 (CDN)

---

## 5. 리스크 및 대응

| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| 한글 폰트 깨짐 | PDF 가독성 저하 | 시스템 폰트 사용, 테스트 우선 진행 |
| CDN 장애 | 기능 사용 불가 | 로컬 파일 백업 준비 |
| 기존 기능 충돌 | 시스템 오류 | 별도 모듈로 분리, 충분한 테스트 |

---

## 6. 체크리스트

- [ ] jsPDF CDN 추가
- [ ] pdf-export.js 파일 생성
- [ ] generateStaffPayrollPDF() 함수 구현
- [ ] generateCommissionPDF() 함수 구현
- [ ] 급여정산 UI에 PDF 버튼 추가
- [ ] 시급제 직원 PDF 테스트
- [ ] 비율제 강사 PDF 테스트
- [ ] 한글 표시 테스트
- [ ] 파일명 형식 테스트
- [ ] 기존 CSV 내보내기 정상 동작 확인
